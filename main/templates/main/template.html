{% load static %}
{% load i18n %}

<!DOCTYPE html>
<html>
<head>
    <title>Language Translator</title>
    <link rel="icon" href="data:,">
    <!-- Add Bootstrap CSS link -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Language Translator</h1>

        <form method="get" class="mb-4">
            <div class="input-group">
                <select class="form-select" id="languageSelect" name="language" {% if not is_toggle_on %}disabled{% endif %}>
                    <option value="Default" disabled>
                            Pilih Bahasa
                    </option>
                    {% for language in languages %}
                        <option value="{{ language.code }}" {% if language.code == selected_language %}selected{% endif %}>
                            {{ language.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </form>

        <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="toggleSwitch" {% if is_toggle_on %}checked{% endif %}>
            <label class="form-check-label" for="toggleSwitch">Toggle On/Off</label>
        </div>

        {% for menu_name, translation in menu_translations.items %}
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">{{ menu_name }}</h5>
                    <p class="translation">{{ translation|default:"Translation not available"|safe }}</p>

                    <img src="https://s3.us-east-1.amazonaws.com/hyunday-file/1694432248462-Icon_Info_JKN.png" alt="Image Description">
                    
                    <button type="button" class="btn btn-success play" id="play" name="play" style="display: none;">Play</button>
                </div>
            </div>
        {% endfor %}

        
    <script>
        const playButtons = document.querySelectorAll('.play');
        const toggleSwitch = document.getElementById('toggleSwitch');
        const select = document.getElementById('languageSelect');
        const translationForm = document.querySelector('form[method="get"]');
        let isToggleOn = toggleSwitch.checked;

        toggleSwitch.addEventListener('change', function () {
            isToggleOn = toggleSwitch.checked;
            localStorage.setItem('isToggleOn', isToggleOn ? 'true' : 'false'); // Store toggle status in local storage as a string

            select.disabled = !isToggleOn;

            // Display the "Play" button when the toggle switch is true
            if (isToggleOn) {
                playButtons.forEach(button => {
                    button.style.display = 'block';
                });
            } else {
                playButtons.forEach(button => {
                    button.style.display = 'none';
                });
                select.selectedIndex = 0;
            }
        });

        // Read the toggle status from local storage when the page loads
        const storedToggleStatus = localStorage.getItem('isToggleOn');
        if (storedToggleStatus === 'true') {
            toggleSwitch.checked = true;
            isToggleOn = true;

             select.disabled = !isToggleOn;

            // Display the "Play" button when the toggle switch is true
            playButtons.forEach(button => {
                button.style.display = 'block';
            });
        } else {
            toggleSwitch.checked = false;
            isToggleOn = false;
            select.selectedIndex = 0;
        }

        // Add an event listener for the language select dropdown change event
        select.addEventListener('change', function () {
            // Submit the form when a language is selected
            translationForm.submit();
        });

        playButtons.forEach(button => {
            button.addEventListener('click', function (e) {
                // Add code to play audio here (if audioPlayer is defined)
            });
        });
    </script>

    </div>
</body>
</html>
